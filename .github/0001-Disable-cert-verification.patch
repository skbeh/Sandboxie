From 622586e9d9c1cdad8783d3f76f5954dc07d2ea77 Mon Sep 17 00:00:00 2001
From: skbeh <60107333+skbeh@users.noreply.github.com>
Date: Mon, 17 Jul 2023 13:20:25 +0000
Subject: [PATCH] Disable cert verification

---
 Sandboxie/core/drv/util.c   | 12 ++----------
 Sandboxie/core/drv/verify.h |  4 ++--
 2 files changed, 4 insertions(+), 12 deletions(-)

diff --git a/Sandboxie/core/drv/util.c b/Sandboxie/core/drv/util.c
index b10c3f44..435361bd 100644
--- a/Sandboxie/core/drv/util.c
+++ b/Sandboxie/core/drv/util.c
@@ -384,15 +384,7 @@ void InitFwUuid();
 
 _FX NTSTATUS MyValidateCertificate(void)
 {
-    if(!*g_uuid_str)
-        InitFwUuid();
-
-    NTSTATUS status = KphValidateCertificate();
-
-    if (status == STATUS_ACCOUNT_EXPIRED)
-        status = STATUS_SUCCESS;
-
-    return status;
+    return STATUS_SUCCESS;
 }
 
 
@@ -500,4 +492,4 @@ ULONG Util_CaptureStack(_Out_ PVOID* Frames, _In_ ULONG Count)
     }
 
     return frames;
-}
\ No newline at end of file
+}
diff --git a/Sandboxie/core/drv/verify.h b/Sandboxie/core/drv/verify.h
index 4de244ea..23e22b7f 100644
--- a/Sandboxie/core/drv/verify.h
+++ b/Sandboxie/core/drv/verify.h
@@ -82,10 +82,10 @@ enum ECertLevel {
     eCertMaxLevel       = 0b111,
 };
 
-#define CERT_IS_TYPE(cert,t)        ((cert.type & 0b11100) == t)
+#define CERT_IS_TYPE(cert,t)        (1)
 #define CERT_IS_SUBSCRIPTION(cert)  (CERT_IS_TYPE(cert, eCertBusiness) || CERT_IS_TYPE(cert, eCertSubscription) || cert.type == eCertEntryPatreon || CERT_IS_TYPE(cert, eCertEvaluation))
 #define CERT_IS_INSIDER(cert)		(CERT_IS_TYPE(cert, eCertEternal) || cert.type == eCertGreatPatreon)
-#define CERT_IS_LEVEL(cert,l)       (cert.active && cert.level >= l)
+#define CERT_IS_LEVEL(cert,l)       (1)
 
 #ifdef KERNEL_MODE
 extern SCertInfo Verify_CertInfo;
-- 
2.41.0

